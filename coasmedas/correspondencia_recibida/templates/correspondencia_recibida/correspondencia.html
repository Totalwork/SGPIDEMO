{% extends 'page.html' %}
{% load static %}

{%block imports_css %}
 <link rel="stylesheet" type="text/css" href='{% static "css/fileInput/fileinput.min.css" %}'>
 <link rel="stylesheet" type="text/css" href='{% static "js/plugins/datepicker/css/bootstrap-datetimepicker.css" %}'>
{% endblock imports_css %}

{% block opciones_listado %}  
  
  <li>
    <a href="#" data-placement="right"  data-toggle="tooltip" data-original-title="Establecer Por revisar">
        <i class="fa fa-envelope" data-bind="click:asignar_por_revisar" style="font-size: 20px;"></i>
    </a>
  </li>  

  <li>
    <a href="#" data-placement="right"  data-toggle="tooltip" data-original-title="Establecer a revisada" >
        <i class="fa fa-envelope-o" data-bind="click:asignar_revisada" style="font-size: 20px;"></i>
    </a>
  </li>  

  <li>
    <a href="#" data-placement="right"  data-toggle="tooltip" data-original-title="Exportar Listado" >
        <i class="fa fa-cloud-download" data-bind="click:exportar_excel" style="font-size: 20px;"></i>
    </a>
  </li>  



{% endblock opciones_listado %}  


{% block title %}Mis Correspondencias{% endblock title%}
{% block mapa %}
  <li><a href="/usuario/"><i class="glyphicon glyphicon-home"></i></a></li>
  <li><a href="/usuario/">Inicio</a></li>
  <li class="active">Correspondencia</li>
  <li class="active">Mis Correspondencias</li>
{% endblock mapa %}
{% block encabezado %}{% endblock encabezado %}

{% block contenido %}   
<input type="text" id="user" value="{{ user.usuario.id }}" hidden> 
<input type="text" id="company" value="{{ user.usuario.empresa.id }}" hidden>  

<div class="row" >

<div class="col-lg-12">   
      
  <div class="panel panel-sky" >
          <div class="panel-heading">
              Listado de mis correspondencias - NÂ° de Registros : </span> <span data-bind="text:paginacion.total"></span>
              <span class="panel-controls">
                <a data-placement="top" data-toggle="tooltip" data-original-title="Filtros"  title="" style="cursor:pointer;" data-bind="click:abrir_modal_busqueda" >
                  <i class="fa fa-filter fa-2x"></i>
                </a>
              </span>
          </div>   
          
          <div class="panel-body" >
            <div data-bind="html: mensaje"></div> 
            <div data-bind="visible:(listado_correspondencias()!=null && listado_correspondencias().length > 0)">  
                    <div class="col-lg-12">
                       <i class="text-success fa fa-bell" style="font-size:16px"></i> 
                       : [Revisada];&nbsp;&nbsp;&nbsp;&nbsp;
                       <i class="text-info fa fa-bell" style="font-size:16px"></i> 
                       : [Por revisar];&nbsp;&nbsp;&nbsp;&nbsp;
                       <i class="text-info fa fa-bell" style="font-size:16px"></i> 
                       : [Reasignada];&nbsp;&nbsp;&nbsp;&nbsp;
                       <i class="text-success fa fa-bell" style="font-size:16px"></i> 
                       : [Respondida];&nbsp;&nbsp;&nbsp;&nbsp;
                       <i class="text-warning fa fa-bell" style="font-size:16px"></i> 
                       : [Anulada];  
                    </div>
                    <br><br>
                    <div class="table-responsive" >
                          <table class="table">
                        <thead>
                      <tr>
                        <th>
                          <div class="option-group field admin-form">
                            <label class="option option-primary"  style="">
                              <input type="checkbox" data-bind="checked:checkall">
                              <span class="checkbox"></span>
                            </label>
                          </div>
                        </th>    
                        <th width="3%">Doc</th>
                        <th width="5%">Radicado</th>
                        <th width="12%">Fecha Recibida</th>
                        <th width="28%">Remitente</th>
                        <th width="30%">Asunto</th>
                        <th width="15%">Estado</th>
                        <th width="3%"></th>
                      </tr>
                    </thead>
                    <tbody data-bind="foreach:{data:listado_correspondencias, as:'item'}">
                      <tr data-bind="css:{'success': item.estado.color == 'success'
                                              ,'warning': item.estado.color == 'warning'
                                              ,'info': item.estado.color == 'info'
                                              }" >
                        <td> 
                          <!--ko if: item.destinatario=={{ user.usuario.id }} -->  
                            <div class="option-group field admin-form">
                              <label class="option option-primary"  style="">
                                <input type="checkbox" data-bind="checked:eliminado,value:id">
                                <span class="checkbox"></span>
                              </label>
                            </div>      
                          <!-- /ko -->     
                        </td> 
                        <!-- ko if: item.totalSoportes==0 -->
                        <td><font color="#FF0000">Pendiente</font></td>
                        <!-- /ko -->
                       
                        <!-- ko if: item.totalSoportes>0 -->
                        <td>
                            <a  target="_blank" style="cursor:pointer;" data-bind="click:$root.abrir_modal_soporte_ver">
                                <i class="fa fa-file kv-caption-icon fa-2x"></i> 
                            </a>
                        </td>
                        <!-- /ko -->
                        <td data-bind="text: item.correspondenciaRecibida.radicado"></td>
                        <td data-bind="text: item.correspondenciaRecibida.fechaRecibida"></td>
                        <td data-bind="text: item.correspondenciaRecibida.remitente"></td>
                        <td data-bind="cutWord:{num:40,text:item.correspondenciaRecibida.asunto, verMax:'...', verMin:'...'}"
                        ></td>
                        <td data-bind="text: item.estado.nombre"></td>
                        <td>
                            <div class="btn-group text-right">
                                <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false" href="#">
                                  <i  class="fa fa-ellipsis-h fa-2x" ></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                  <!--ko if: item.destinatario=={{ user.usuario.id }} --> 
                                    <li>
                                      <a href="#" data-bind="click:$root.abrir_modal_historial">Historial de la carta</a>
                                    </li>
                                    <li>
                                      <a href="#" data-bind="click:$root.abrir_modal_respuesta">Tiempo de respuesta</a>
                                    </li>                                 
                                    <li>
                                      <a href="#" data-bind="click:$root.abrir_modal_respuesta_radicado">Responder</a>
                                    </li>                                
                                    <li>
                                      <a href="#" data-bind="click:$root.abrir_modal_reasignar">Reasignar</a>
                                    </li>
                                  <!-- /ko --> 
                                                      
                                </ul>
                            </div>
                        </td>       
                      </tr>
                    </tbody>
                  </table>
                  </div>              
                  <div id="paginacion" >
                    <div data-bind="pagination: {
                                   currentPage: paginacion.pagina_actual,
                                   totalCount: paginacion.total,
                                   pageSize:paginacion.cantidad_por_paginas,
                                   maxPages: paginacion.maxPaginas,
                                   directions: paginacion.direcciones,
                                   boundary: paginacion.limite,
                                   text: paginacion.text }">

                    </div>
                  </div>
            </div>
        </div>
  </div>	
  </div>
</div>

<div id="modal_busqueda" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" >
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>
       <div class="panel-body bg-light">
          
           <form action="." method="post">
            <!-- {% csrf_token %}  -->

               <div class="col-lg-7"  >  
                  <div  class="panel" >
                    <div class="panel-heading">
                      <span class="panel-title">Datos Generales</span>
                    </div>
                    <div class="panel-body" > 
                      
                      <div class="form-group" >
                        <label>Estado</label>
                        <select class="form-control form-group" data-bind='value:correspondenciaRecibidaVO_filtro.estado'>   
                            <option value="">Seleccione el estado...</option> 
                            <!--ko foreach: { data:listado_estados_correspondencia_recibida , as:'item'}-->        
                              <option data-bind="value:item.id, text: item.nombre"></option>
                            <!-- /ko -->
                        </select>  
                      </div>

                      <div class="form-group" >
                        <label>Elaborado Por</label>
                        <select class="form-control form-group" data-bind='value:correspondenciaRecibidaVO_filtro.usuarioElaboro' >    
                            <option value="">Seleccione el funcionario...</option> 
                            <!--ko foreach: { data:listado_funcionarios_elaboran , as:'item'}-->        
                              <option data-bind="value:item.id, text: (item.persona.nombres+' '+item.persona.apellidos+' - ('+user.username+')' ) "></option>
                            <!-- /ko -->
                        </select>  
                      </div>
                      <div class="form-group" >
                        <label>Tiene Soporte</label>
                        <div class="col-lg-12">
                          <label class="checkbox-inline mr10">
                            <input id="inlineCheckbox1" data-bind="checked : correspondenciaRecibidaVO_filtro.soporte_si"  type="checkbox">Si
                          </label>

                          <label class="checkbox-inline mr10">
                            <input id="inlineCheckbox1" data-bind="checked : correspondenciaRecibidaVO_filtro.soporte_no"  type="checkbox">No
                          </label>
                        </div>          
                      </div> 

                      <div class="form-group" >     
                        <label>Campos de busqueda</label>
                        <div class="col-lg-12">
                          <label class="checkbox-inline mr10">
                            <input id="inlineCheckbox1" data-bind="checked : correspondenciaRecibidaVO_filtro.asunto"  type="checkbox">Asunto
                          </label>

                          <label class="checkbox-inline mr10">
                            <input id="inlineCheckbox1" data-bind="checked : correspondenciaRecibidaVO_filtro.remitente"  type="checkbox">Remitente
                          </label>

                          <label class="checkbox-inline mr10">
                            <input id="inlineCheckbox1" data-bind="checked : correspondenciaRecibidaVO_filtro.radicado"  type="checkbox">Radicado
                          </label>
                        </div>  
                      </div> 
                      <!-- <div class="form-group" >  
                        <label>Texto de busqueda</label>
                        <input type="text" class="form-control" id="txtBuscar" placeholder=" Digite el texto de busqueda, el cual serÃ¡ buscado en el asunto, referencia y consecutivo." >
                      </div> -->
                    </div>  
                  </div>  
                </div>  
                <!-- datos generales --> 

                <div class="col-lg-5"  >  
                  <div  class="panel" >
                    <div class="panel-heading">
                      <span class="panel-title">Rango de Busqueda Por Fecha</span>
                    </div>
                    <div class="panel-body" > 
                      
                   
                      <div class="form-group" >
                        <label>Desde</label>
                        <input type="text" class="form-control" data-bind='datePicker:correspondenciaRecibidaVO_filtro.fechaDesde ,value:correspondenciaRecibidaVO_filtro.fechaDesde' placeholder="Digite el numero de replanteo" id="fecha_inicio" >
                        <span id="valDesde" class="validationMessage" style="display:none;">(*) La fecha desde no puede ser mayor que la fecha hasta.</span>
                      </div>

                      <div class="form-group" >
                        <label>Hasta</label>
                        <input type="text" class="form-control" data-bind='datePicker:correspondenciaRecibidaVO_filtro.fechaHasta ,value: correspondenciaRecibidaVO_filtro.fechaHasta' placeholder="Digite el numero de replanteo" id="fecha_final" >
                        <span id="valHasta" class="validationMessage" style="display:none;">(*) La fecha hasta no puede ser menor que la fecha desde.</span>
                      </div>
                      
                    </div>  
                  </div>  
                </div> 
                <!-- rango de fechas -->     
            </form>
         
       </div>     

        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bind="click: function(){ consultar(1) }">Consultar</button>
        </div>

    </div>
  </div>
</div>
<!--Modal consulta de Correspondencia-->


<!--Modal Historial de la carta-->
<div id="modal_acciones_historial" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>

       <div class="panel-body"> 

            <ul class="icon-list">
              <li>
                <b> Radicado:</b>&nbsp;<small data-bind="html: correspondenciaRecibidaVO.radicado"></small>
              </li>
              <li>
                <b> Remitente:</b>&nbsp;<small data-bind="html: correspondenciaRecibidaVO.remitente"></small>
              </li>
              <li>
                <b> Asunto:</b>&nbsp;<small data-bind="html: correspondenciaRecibidaVO.asunto"></small>
              </li>
              <li>
                <b> Fecha correspondencia:</b>&nbsp;<small data-bind="html: correspondenciaRecibidaVO.fechaRecibida"></small>
              </li>
            </ul>

            <div data-bind="html: mensajeAsignados"></div>      
            <div data-bind="visible:(listado_historial_carta()!=null && listado_historial_carta().length > 0)">    
              <div class="col-lg-12" >
                <div class="table-responsive" >
                <table class="table">
                      <thead>
                    <tr> 
                      <th>Movimiento</th>
                      <th>Funcionario</th> 
                      <th>Fecha Asignacion</th>   
                      <th>Estado</th>    
                      <th>Respuesta</th>                                                    
                    </tr>
                  </thead>
                  <tbody data-bind="foreach:{data:listado_historial_carta, as:'item'}">
                    <tr>
                    <td data-bind="text:($index()+1)"></td> 
                    <td data-bind="text: item.usuario.persona.nombres+' '+item.usuario.persona.apellidos"></td>  
                    <td data-bind="text: moment(item.fechaAsignacion).format('LL  - h:mm:ss a')"></td>  
                    <td data-bind="text: item.estado.nombre"></td> 
                    <!--ko if: item.respuesta==null --> 
                    <td></td>
                    <!-- /ko --> 
                    <!--ko if: item.respuesta!=null --> 
                    <td data-bind="text: item.respuesta.prefijo.nombre+'-'+item.respuesta.consecutivo"></td>
                    <!-- /ko --> 
                                   
                    </tr>
                  </tbody>
                </table>
                </div>              
              </div> 
            </div>                               
       </div>     
    </div>
  </div>
</div>
<!--Modal Historial de la carta-->


<!--Modal form ver soporte-->
<div id="modal_acciones_soporte_ver" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>
       <div class="modal-body">
       
          <div class="col-md-12"> 
            <div  class="panel" >
              <div class="panel-heading">
                <span class="panel-title">Soportes de la carta</span>
              </div>
              <div class="panel-body" > 

                <div data-bind="html: mensajePorAsignar"></div>  

                <div class="col-lg-12" data-bind="visible:(listado_correspondencia_soportes()!=null && listado_correspondencia_soportes().length > 0)">                     

                    <div class="table-responsive">
                            <table class="table">
                          <thead>
                        <tr>                 
                          <th width="20%">Soporte</th>
                          <th width="80%">Nombre</th>          
                        </tr>
                      </thead>
                      <tbody data-bind="foreach:{data:listado_correspondencia_soportes, as:'item'}">
                        <tr>
                          <td>
                              <a data-bind="click: $root.ver_soporte" href="#" style="cursor:pointer;">
                                <i class="fa fa-file kv-caption-icon"></i> Documento
                              </a>
                          </td>
                          <td data-bind="text: item.nombre"></td>         
                        </tr>
                      </tbody>
                    </table>
                    </div> 
                </div>
              </div>
            </div>
          </div>  

       </div>
       
    </div>
  </div>
</div>
<!--Modal form ver soporte-->


<!--Modal form tiempo de respuesta-->
<div id="modal_acciones_respuesta" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>
      <div class="modal-body">
        <div class="form-group" >
          <label>Fecha de respuesta:</label>
          <input type="text" class="form-control" data-bind='datePicker:correspondenciaRecibidaVO.fechaRespuesta ,value: correspondenciaRecibidaVO.fechaRespuesta , dateTimePickerOptions:{minDate: new Date() }' placeholder="AAAA-MM-DD" id="fecha_final" >
        </div>
        
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bind="click: function(){ guardar_fecha_respuesta() }">Guardar</button>
      </div>       
    </div>
  </div>
</div>
<!--Modal form ver soporte-->


<!--Modal form tiempo de respuesta-->
<div id="modal_acciones_reasignar" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>
      <div class="modal-body">
        
        <div class="col-md-12"  >  
          <div  class="panel" >
            <div class="panel-heading">
              <span class="panel-title">Destinatario</span>
            </div>
            <div class="panel-body" >
              <div class="input-group form-group">
                  <input class="form-control" placeholder="Nombres o apellidos" type="text" id ="filtro_Destinatario"  data-bind="event:{keypress:consultar_usuarios_reasignar_enter }">
                    <span class="input-group-addon" data-bind="click:consultar_usuarios_reasignar_btn" >Consultar</span>
              </div>
              <div class="form-group">
                    <select class="form-control form-group" size="10"  data-bind='value: usuarioAsignarCarta' >  
                            <!--ko foreach: { data:listado_usuarios_reasignar , as:'item'}-->        
                              <option data-bind="value:item.id, text:(item.persona__nombres+' '+item.persona__apellidos+' - ('+user__username+')' )"></option>
                            <!-- /ko -->
                    </select>     
              </div>     
            </div> 
          </div> 
        </div>
        
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bind="click: asignar_carta">Asignar</button>
      </div>       
    </div>
  </div>
</div>
<!--Modal form ver soporte-->


<div id="modal_acciones" class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="width:100%">
    <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridModalLabel" data-bind='text:titulo'></h4>
      </div>
       <div class="modal-body bg-light">          
            <form action="." method="post" enctype="multipart/form-data" id="form-wizard">
            <!-- {% csrf_token %}    -->  
                  <div class="col-md-12">  
                    <div  class="panel" >
                    <div class="panel-heading">
                      <span class="panel-title">Datos generales</span>
                    </div>
                    <div class="panel-body" >  
                          <div class="col-lg-2">          
                              <label>(*) Privado</label> 
                                <div class="radio-custom mb ">    
                                  <input id="radioExample3" name="radioExample" type="radio" data-bind="checked : correspondenciaEnviadaVO.privado" value="true" >                              
                                  <label style="display:block;" for="radioExample3" class="radio-inline" >Si</label> 

                                </div>
                                <div class="form-group radio-custom radio-primary mb5 ">
                                  <input id="radioExample4" name="radioExample" type="radio" data-bind="checked : correspondenciaEnviadaVO.privado" value="false" >
                                  <label style="display:block;" for="radioExample4" class="radio-inline" >No</label>  
                                </div>                              
                           </div>  
                           <!-- ko if: correspondenciaEnviadaVO.id()==0 -->
                           <div class="form-group col-lg-2">
                              <label>(*) Fecha De Envio</label>
                              <input type="text" placeholder="Digite la fecha de envio." class="form-control" data-bind='datePicker:correspondenciaEnviadaVO.fechaEnvio,value:correspondenciaEnviadaVO.fechaEnvio'>       
                            </div>
                            <!-- /ko -->
                            <!-- ko if: correspondenciaEnviadaVO.id()>0 -->
                            <div class="form-group col-lg-2">
                             <label>(*) Fecha De Envio</label>
                              <input type="text" class="form-control" data-bind='value:correspondenciaEnviadaVO.fechaEnvio' readonly>  
                            </div>
                            <!-- /ko -->

                            <div class="form-group col-lg-3">
                              <label>(*) Departamento </label>
                              <select class="form-control" data-bind="value: correspondenciaEnviadaVO.departamento_id"  >
                                  <option value="">Seleccione el departamento de ubicaciÃ³n...</option>        
                                  <!--ko foreach: { data:listado_departamentos , as:'item'}-->        
                                    <option data-bind="value:id, text:nombre"></option>
                                  <!-- /ko -->
                              </select>     
                            </div>

                            <div class="form-group col-lg-3">          
                              <label>(*) Ciudad</label>
                              <select class="form-control" data-bind="options: listado_municipios,
                                                 optionsText: 'nombre', 
                                                 optionsValue: 'id', 
                                                 optionsCaption: 'Seleccione la ciudad de ubicaciÃ³n...',
                                                 value: correspondenciaEnviadaVO.ciudad_id
                                                 ">
                              </select>    
                            </div>                            

                            <div class="form-group col-lg-2">          
                              <label>(*) Prefijo</label>
                              <select class="form-control" data-bind="options: listado_prefijos,
                                                 optionsText: 'nombre', 
                                                 optionsValue: 'id', 
                                                 optionsCaption: 'Seleccione el prefijo...',
                                                 value: correspondenciaEnviadaVO.prefijo_id
                                                 ">
                              </select>    
                            </div>
                            <div class="form-group col-lg-7">          
                              <label>Asunto</label>
                              <input type="text" placeholder="Digite el asunto de la carta." class="form-control" data-bind='value:correspondenciaEnviadaVO.asunto'>   
                            </div>
                            <div class="form-group col-lg-5">          
                              <label>Referencia</label>
                              <input type="text" placeholder="Digite la referencia de la carta." class="form-control" data-bind='value:correspondenciaEnviadaVO.referencia'>   
                            </div>

                            <div class="form-group  col-lg-7">
                                <div class="form-group col-lg-12">  
                                  <label>Contenido</label>                                
                                  <textarea>
                                  </textarea>
                                </div>
                                <div class="form-group col-lg-6">          
                                  <label>(*) Firma</label>
                                  <select class="form-control form-group" data-bind='value:correspondenciaEnviadaVO.firma_id' >  
                                          <option value="">Seleccione el funcionario...</option> 
                                          <!--ko foreach: { data:listado_funcionarios_firma , as:'item'}-->        
                                            <option data-bind="value:item.id, text: item.persona.nombres+' '+item.persona.apellidos "></option>
                                          <!-- /ko -->
                                  </select>     
                                </div>   
                            </div>
                            <!-- ko if: correspondenciaEnviadaVO.id()==0 -->
                            <div class="form-group col-md-5"  >  
                              <div  class="panel" >
                                <div class="panel-heading">
                                  <span class="panel-title">Destinatario</span>
                                </div>
                                <div class="panel-body" >
                                      <label>Se encuentra en el grupo SININ:</label>     
                                      <div class="col-lg-12">
                                          <div class="radio-custom mb col-lg-2">    
                                            <input id="radioDestinatario5" name="radioDestinatario" type="radio" data-bind="checked : correspondenciaEnviadaVO.grupoSinin" value="1" >                   
                                            <label for="radioDestinatario5" class="radio-inline" >Si</label>
                                           
                                          </div>
                                          <div class="radio-custom radio-primary mb5 col-lg-2">
                                            <input id="radioDestinatario6" name="radioDestinatario" type="radio" data-bind="checked : correspondenciaEnviadaVO.grupoSinin" value="0" >
                                             <label for="radioDestinatario6" class="radio-inline" >No</label>
                                            
                                          </div>
                                      </div>
                                      <!-- ko if: correspondenciaEnviadaVO.grupoSinin()=='1' -->
                                      <div id="divDestinatarioGrupoSININ">
                                        <div class="form-group">
                                            <select class="form-control form-group" data-bind="value: filtro_empresaDestinatario" >  
                                                    <option value="">Seleccione la empresa ...</option> 
                                                    <!--ko foreach: { data:listado_empresas , as:'item'}-->        
                                                      <option data-bind="value:item.id, text: item.nombre "></option>
                                                    <!-- /ko -->
                                            </select>  
                                        </div> 
                                        <div class="input-group form-group">
                                            <input class="form-control" placeholder="Nombres o apellidos" type="text" id="filtro_Destinatario" data-bind="event:{keypress: consultar_funcionarios_enter }" >
                                              <span class="input-group-addon"  data-bind="click:consultar_funcionarios_btn" >Consultar</span>
                                        </div> 

                                        <div class="form-group">
                                            <select class="form-control form-group" size="9" data-bind='value:correspondenciaEnviadaVO.destinatario'>  
                                                    <!--ko foreach: { data:listado_funcionarios , as:'item'}-->        
                                                      <option data-bind="value:item.id, text: item.persona__nombres+' '+item.persona__apellidos+' - ('+item.user__username+')'"></option>
                                                    <!-- /ko -->
                                            </select>  
                                        </div>   
                                      </div> 
                                      <!-- /ko -->
                                      <!-- ko if: correspondenciaEnviadaVO.grupoSinin()=='0' -->
                                      <div id="divDestinatarioForm">
                                          <div class="form-group">          
                                            <label>Empresa:</label>
                                            <input type="text" class="form-control" data-bind="value: correspondenciaEnviadaVO.empresa_destino" >   
                                          </div>
                                          <div class="form-group">          
                                            <label>Cargo:</label>
                                            <input type="text" class="form-control" data-bind="value: correspondenciaEnviadaVO.cargo_persona" >   
                                          </div>
                                          <div class="form-group">          
                                            <label>Atn:</label>
                                            <input type="text" class="form-control" data-bind="value: correspondenciaEnviadaVO.persona_destino" >   
                                          </div>
                                          <div class="form-group">          
                                            <label>DirecciÃ³n:</label>
                                            <input type="text" class="form-control" data-bind="value: correspondenciaEnviadaVO.direccion" >   
                                          </div>
                                          <div class="form-group">          
                                            <label>Telefono:</label>
                                            <input type="text" class="form-control" data-bind="value: correspondenciaEnviadaVO.telefono" >   
                                          </div>
                                                                        
                                      </div> 
                                      <!-- /ko -->
                                      <div class="form-group">
                                        <label>(*) Departamento </label>
                                        <select class="form-control" data-bind="value: departamentoEmpresa_id"  >
                                            <option value="">Seleccione el departamento de ubicaciÃ³n...</option>        
                                            <!--ko foreach: { data:listado_departamentosEmpresa , as:'item'}-->        
                                              <option data-bind="value:id, text:nombre"></option>
                                            <!-- /ko -->
                                        </select>     
                                      </div>
                                      <div class="form-group">          
                                        <label>(*) Ciudad del Destinatario</label>
                                        <select class="form-control" data-bind="options: listado_municipiosEmpresa,
                                                           optionsText: 'nombre', 
                                                           optionsValue: 'id', 
                                                           optionsCaption: 'Seleccione la ciudad de ubicaciÃ³n...',
                                                           value: correspondenciaEnviadaVO.municipioEmpresa_id
                                                           ">
                                        </select>    
                                      </div>  
                                </div> 
                              </div> 
                            </div>  
                            <!-- /ko -->
                                                                  
                      </div> 
                    </div> 
                  </div> 
                  <!-- fin datos generales -->
                  
                  <!-- ko if: correspondenciaEnviadaVO.id()==0 -->
                  <div class="form-group col-md-6">  
                    <div  class="panel" >
                      <div class="panel-heading">
                        <span class="panel-title">Agregar copia</span>
                      </div>
                      <div class="panel-body" >
                        <div class="form-group">
                            <select class="form-control form-group" data-bind="value: filtro_empresaDestinatarioCopia" >  
                                    <option value="">Seleccione la empresa ...</option> 
                                    <!--ko foreach: { data:listado_empresas , as:'item'}-->        
                                      <option data-bind="value:item.id, text: item.nombre "></option>
                                    <!-- /ko -->
                            </select>  
                        </div> 
                        <div class="input-group form-group">
                            <input class="form-control" placeholder="Nombres o apellidos" type="text" id="filtro_DestinatarioCopia" data-bind="event:{keypress:consultar_funcionariosCopia_enter }" >
                              <span class="input-group-addon"  data-bind="click:consultar_funcionariosCopia_btn" >Consultar</span>    
                        </div>
                        <div class="form-group">
                            <select class="form-control form-group" size="7" id="destinatarioCopia" data-bind="event:{dblclick:asignar_copia} ">  
                                    <!--ko foreach: { data:listado_funcionarios_copia , as:'item'}-->        
                                      <option data-bind="value:item.id, text: item.persona__nombres+' '+item.persona__apellidos+' - ('+item.user__username+')' "></option>
                                    <!-- /ko -->
                            </select>  
                        </div> 
                      </div> 
                    </div> 
                  </div> 

                  <div class="form-group col-md-6">  
                    <div  class="panel" >
                      <div class="panel-heading">
                        <span class="panel-title">Usuarios  con  copia</span>
                      </div>
                      <div class="panel-body" >
                        <div class="form-group">
                          <select class="form-control form-group" size="18" id="destinatarioConCopia" data-bind="event:{dblclick:quitar_copia} " >  
                              <!--ko foreach: { data:listado_destinatarios_con_copia , as:'item'}-->        
                                <option data-bind="value:item.id, text: item.nombres "></option>
                              <!-- /ko -->
                          </select>      
                        </div> 
                      </div> 
                    </div> 
                  </div> 
                  <!-- /ko -->

          </form>
            <!-- End Account2 Form -->                    
         
       </div>     

        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bind="click:guardar_correspondenciaEnviada">Generar Consecutivo</button>
        </div>

    </div>
  </div>
</div>
<!--Modal Correspondencia-->

{% endblock contenido %}

{% load static %}

{%block imports %}
  <script src="https://cdn.tiny.cloud/1/emtxaaumygjz7hfwlsvkmv5zwmvp1ywdl72d04cofj48lyzp/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
  <script src='{% static "js/plugins/moment/moment.min.js" %}'></script>
  <script type="text/javascript" src='{% static "js/plugins/datepicker/js/bootstrap-datetimepicker.js" %}'></script>
  <script type="text/javascript" src='{% static "js/plugins/fileInput/fileinput.js" %}'></script>
  <script type="text/javascript" src='{% static "js/ViewModels/correspondencia_recibida/correspondenciaRecibida.js" %}?v=1.2'></script>
  <script type="text/javascript">
    $(document).ready(function () {

      tinymce.init({
          selector: 'textarea',
          height: 400,
          menubar: false,
          plugins: [
            'advlist autolink lists charmap print preview anchor',
            'searchreplace visualblocks code fullscreen',
            'insertdatetime media contextmenu paste code',

          ],
          toolbar: 'undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist outdent indent | ',
          content_css: '//www.tinymce.com/css/codepen.min.css'
        });


      correspondencia.consultar_mis_correspondencias(1);
      correspondencia.consultar_usuarios_reasignar();
      /*correspondencia.consultar_estados_correspondencia();*/
      
      /*correspondencia.consultar_funcionarios_elaboran();*/
    });  

  </script>
  <!-- END: PAGE SCRIPTS -->
{% endblock imports %}